<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPAIO - Official Ecosystem</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        /* 리더님의 기존 디자인 스타일 유지 */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #0f172a; color: #f8fafc; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .card { background: #1e293b; padding: 3rem; border-radius: 2rem; text-align: center; border: 1px solid #334155; max-width: 450px; width: 90%; }
        .status-badge { display: block; background: #064e3b; color: #34d399; padding: 0.8rem 1rem; border-radius: 1rem; font-weight: bold; cursor: pointer; border: none; margin-top: 1rem; width: 100%; }
        .pay-btn { background: #0369a1; color: #e0f2fe; }
    </style>
</head>
<body>
    <div class="card">
        <h1>XPAIO</h1>
        <p id="status-text">Render 서버 연결 시도 중...</p>
        <button class="status-badge" onclick="login()">● 지갑 인증하기</button>
        <button class="status-badge pay-btn" onclick="transferPi()">⚡ 1 Test-Pi 후원하기</button>
    </div>

    <script>
        const Pi = window.Pi;
        // [중요] 리더님의 Render 서버 주소로 수정하세요!
        const RENDER_SERVER_URL = "https://xpaio-token.onrender.com"; 

        window.onload = function() {
            try {
                Pi.init({ version: "2.0", sandbox: true });
                login();
            } catch (e) { console.error(e); }
        };

        async function login() {
            try {
                const auth = await Pi.authenticate(['username', 'payments'], onIncompletePaymentFound);
                document.getElementById('status-text').innerText = auth.user.username + "님 환영합니다!";
            } catch (err) { console.error(err); }
        }

        async function transferPi() {
            try {
                const payment = await Pi.createPayment({
                    amount: 1.0,
                    memo: "XPAIO Render Test",
                    metadata: { orderId: "XPAIO-" + Date.now() }
                }, {
                    onReadyForServerApproval: async (paymentId) => {
                        // Render 서버의 정석 경로로 데이터 전송
                        await fetch(`${RENDER_SERVER_URL}/xpaio-token/app/adi/payment`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ paymentId })
                        });
                    },
                    onReadyForServerCompletion: (paymentId, txid) => { alert("결제 완료! TXID: " + txid); },
                    onCancel: (id) => console.log("취소"),
                    onError: (err) => console.error(err)
                });
            } catch (err) { alert("결제창을 열 수 없습니다. 8자리 코드를 확인하세요."); }
        }

        async function onIncompletePaymentFound(payment) {
            await fetch(`${RENDER_SERVER_URL}/xpaio-token/app/adi/payment`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ paymentId: payment.identifier })
            });
        }
    </script>
</body>
</html>